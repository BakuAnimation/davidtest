(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65365244"],{"159b":function(e,t,n){var r=n("da84"),o=n("fdbc"),a=n("17c2"),c=n("9112");for(var i in o){var s=r[i],d=s&&s.prototype;if(d&&d.forEach!==a)try{c(d,"forEach",a)}catch(l){d.forEach=a}}},"17c2":function(e,t,n){"use strict";var r=n("b727").forEach,o=n("b301");e.exports=o("forEach")?function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}:[].forEach},4160:function(e,t,n){"use strict";var r=n("23e7"),o=n("17c2");r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},"78d9":function(e,t,n){},e2f9:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isConnected?n("HelloWorld"):n("QrReader")],1)},o=[],a=n("9f12"),c=n("8b83"),i=n("c65a"),s=n("c03e"),d=n("9ab4"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",[e._v("Smartphone LocalVideo")]),n("video",{attrs:{id:"localVideo",playsinline:"",autoplay:"",muted:""},domProps:{muted:!0}})])},u=[],h=n("60a3"),p=function(e){function t(){return Object(a["a"])(this,t),Object(c["a"])(this,Object(i["a"])(t).apply(this,arguments))}return Object(s["a"])(t,e),t}(h["b"]);p=d["a"]([h["a"]],p);var f=p,v=f,m=n("2877"),b=Object(m["a"])(v,l,u,!1,null,null,null),g=b.exports,O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"about"},[n("h1",[e._v("This is an about page")]),n("p",{staticClass:"error"},[e._v(e._s(e.error))]),n("p",{staticClass:"decode-result"},[e._v(" Last result: "),n("b",[e._v(e._s(e.socketId))])]),e.activeqrreader?n("qrcode-stream",{on:{decode:e.onDecode,init:e.onInit}}):n("video",{attrs:{id:"localVideo",autoplay:"",playsinline:"",width:"1920",height:"1080"}})],1)},E=[],k=(n("4160"),n("b0c0"),n("159b"),n("96cf"),n("89ba")),R=n("53fe"),C=n("9a3e"),y=n("8055"),w=n.n(y),j=function(e){function t(){var e;return Object(a["a"])(this,t),e=Object(c["a"])(this,Object(i["a"])(t).apply(this,arguments)),e.socketId=void 0,e.socket=w()(),e.error="",e.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),e.activeqrreader=!0,e}return Object(s["a"])(t,e),Object(R["a"])(t,[{key:"mounted",value:function(){var e=this;this.socket.on("rtcOffer",(function(t){console.log("call startStream ",t),e.startStream(t)})),this.socket.on("icecandidate",(function(t){e.peerConnection.addIceCandidate(t)})),this.peerConnection.addEventListener("icecandidate",this.onIceCandaidate.bind(this)),this.peerConnection.onconnectionstatechange=function(t){"connected"==e.peerConnection.connectionState&&(console.log("CONNECTION OK"),e.$store.commit("setupConnection"))}}},{key:"onDecode",value:function(e){console.log("onDecode",e,this.socketId),this.socketId||(this.activeqrreader=!1,this.socketId=e,this.socket.emit("link",this.socketId))}},{key:"onInit",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),"NotAllowedError"===e.t0.name?this.error="ERROR: you need to grant camera access permisson":"NotFoundError"===e.t0.name?this.error="ERROR: no camera on this device":"NotSupportedError"===e.t0.name?this.error="ERROR: secure context required (HTTPS, localhost)":"NotReadableError"===e.t0.name?this.error="ERROR: is the camera already in use?":"OverconstrainedError"===e.t0.name?this.error="ERROR: installed cameras are not suitable":"StreamApiNotSupportedError"===e.t0.name&&(this.error="ERROR: Stream API is not supported in this browser");case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"startStream",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t){var n,r,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.localVideo=document.getElementById("localVideo"),e.next=3,navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}}});case 3:return n=e.sent,console.log("Received local stream"),this.localVideo.srcObject=n,this.peerConnection.ondatachannel=function(e){var t=e.channel;o.setChannelEvents(t)},n.getVideoTracks().forEach((function(e){return o.peerConnection.addTrack(e,n)})),e.prev=8,console.log("remoteOffer",t,this.peerConnection),e.next=12,this.peerConnection.setRemoteDescription(t);case 12:e.sent,e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](8),console.error("Failed to set remote description",e.t0);case 18:return e.prev=18,console.log("createAnswer",this.socketId),e.next=22,this.peerConnection.createAnswer();case 22:return r=e.sent,e.next=25,this.peerConnection.setLocalDescription(r);case 25:this.socket.emit("rtcAnswer",r),e.next=31;break;case 28:e.prev=28,e.t1=e["catch"](18),console.error("Failed sending answer",e.t1);case 31:case"end":return e.stop()}}),e,this,[[8,15],[18,28]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setChannelEvents",value:function(e){e.onmessage=function(e){var t=JSON.parse(e.data);if("cmd"===t.type){var n=document.createElement("canvas"),r=document.getElementById("localVideo");n.width=r.videoWidth,n.height=r.videoHeight;var o=n.getContext("2d");o.drawImage(r,0,0,n.width,n.height);var a=n.toDataURL(),c=document.createElement("a");c.setAttribute("href",a),c.setAttribute("download","toto.png"),c.click()}},e.onopen=function(){var t=e.send;e.send=function(e){console.log("Sending message: ",e),t(JSON.stringify(e))}},e.onerror=function(e){console.error("channel.onerror",JSON.stringify(e,null,"\t"))},e.onclose=function(e){console.warn("channel.onclose",JSON.stringify(e,null,"\t"))}}},{key:"onIceCandaidate",value:function(e){this.socket.emit("icecandidate",e.candidate)}}]),t}(h["b"]);j=d["a"]([Object(h["a"])({components:{QrcodeStream:C["QrcodeStream"]}})],j);var S=j,x=S,I=(n("fd58"),Object(m["a"])(x,O,E,!1,null,"299dd5a4",null)),_=I.exports,N=n("4bb5"),A=function(e){function t(){var e;return Object(a["a"])(this,t),e=Object(c["a"])(this,Object(i["a"])(t).apply(this,arguments)),e.isConnected=!1,e}return Object(s["a"])(t,e),t}(h["b"]);d["a"]([N["a"]],A.prototype,"isConnected",void 0),A=d["a"]([Object(h["a"])({components:{Smartphone:g,QrReader:_}})],A);var V=A,D=V,T=Object(m["a"])(D,r,o,!1,null,null,null);t["default"]=T.exports},fd58:function(e,t,n){"use strict";var r=n("78d9"),o=n.n(r);o.a}}]);
//# sourceMappingURL=chunk-65365244.b19bf3bd.js.map